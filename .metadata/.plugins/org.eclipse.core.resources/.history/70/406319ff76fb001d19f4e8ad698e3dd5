
<%@ page import="javax.servlet.jsp.tagext.TryCatchFinally"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%@ page import="kr.ac.kopo07.ctc.kopo07.dao.*"%>
<%@ page import="kr.ac.kopo07.ctc.kopo07.domain.*"%>

<!-- JDBC 사용시 필요한 임포트 -->
<%@ page import="java.sql.*"%>
<%@ page import="javax.sql.*"%>
<%@ page import="java.io.*"%>
<%@ page import="java.util.*"%>

<HTML>
<HEAD>
</HEAD>
<link rel="stylesheet" href="css/selectAll.css">

<BODY>

	<center>
		<table>
			<thead>
				<tr id="thead">
					<th>이름</th>
					<th>번호</th>
					<th>국어점수</th>
					<th>영어점수</th>
					<th>수학점수</th>
					<th>총점</th>
					<th>평균</th>
					<th>등수</th>
				</tr>
			</thead>

			<%
			StudentItemDao StudentItemDao = new StudentItemDaoImpl();
			List<StudentItem> studentList = StudentItemDao.selectAllStudent();

			//===============================================================

			Map<Long, Integer> map = new HashMap<>();

			for (StudentItem student : studentList) {
				int kor = student.getKor();
				int eng = student.getEng();
				int mat = student.getMat();
				map.put(student.getId(), kor + eng + mat);
			}

			List<Map.Entry<Long, Integer>> entryList = new LinkedList<>(map.entrySet());
			entryList.sort(new Comparator<Map.Entry<Long, Integer>>() {
				@Override
				public int compare(Map.Entry<Long, Integer> o1, Map.Entry<Long, Integer> o2) {
					return o2.getValue() - o1.getValue();
				}
			});

			for (Map.Entry<Long, Integer> entry : entryList) {
				out.print("아이디 : " + entry.getKey() + ", 합계 : " + entry.getValue());
			}

			//===============================================================

			for (StudentItem student : studentList) {
			%>

			<tbody>
				<tr>
					<td><a id="clickhere"
						href="select.jsp?id=<%=student.getId()%>"><%=student.getName()%></a></td>
					<td><%=student.getStudentid()%></td>
					<td><%=student.getKor()%></td>
					<td><%=student.getEng()%></td>
					<td><%=student.getMat()%></td>

					<%
					int sum = student.getKor() + student.getEng() + student.getMat();

					double avg = (student.getKor() + student.getEng() + student.getMat()) / 3;
					map.put(student.getId(), sum);

					for (Map.Entry<Long, Integer> entry : entryList) {
						out.print("아이디 : " + entry.getKey() + ", 합계 : " + entry.getValue());
						for (StudentItem str : studentList) {
							if (entry.getKey() == str.getId()) {
							}

						}
					}

					//===========================================================================
					%>

					<td><%=sum%></td>
					<td><%=avg%></td>


					<td>등수</td>

				</tr>
				<%
				}
				%>
			</tbody>

		</table>
	</center>

</BODY>
</HTML>